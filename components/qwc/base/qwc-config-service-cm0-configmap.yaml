apiVersion: v1
data:
  config.json: |
    {
      "routingServiceUrl": "https://valhalla1.openstreetmap.de/",
      "omitUrlParameterUpdates":false,
      "urlPositionFormat":"centerAndZoom",
      "urlPositionCrs":"",
      "preserveBackgroundOnThemeSwitch":true,
      "preserveExtentOnThemeSwitch":true,
      "preserveNonThemeLayersOnThemeSwitch":false,
      "allowAddingOtherThemes":true,
      "allowLayerTreeSeparators":false,
      "allowRemovingThemeLayers":true,
      "allowReorderingLayers":true,
      "preventSplittingGroupsWhenReordering":false,
      "globallyDisableDockableDialogs":false,
      "searchThemes":true,
      "allowFractionalZoom":false,
      "localeAwareNumbers":false,
      "identifyTool":"Identify",
      "wmsDpi":96,
      "wmsHidpi":false,
      "qgisServerVersion":3,
      "defaultFeatureStyle":{
        "strokeColor":[
          0,
          0,
          255,
          1
        ],
        "strokeWidth":1,
        "strokeDash":[
          4
        ],
        "fillColor":[
          255,
          0,
          255,
          0.33
        ],
        "circleRadius":10,
        "textFill":"black",
        "textStroke":"white",
        "textFont":"11pt sans-serif"
      },
      "importLayerUrlPresets":[
        {
          "label":"Swisstopo WMTS",
          "value":"https://wmts10.geo.admin.ch/EPSG/2056/1.0.0/WMTSCapabilities.xml"
        }
      ],
      "projections":[
        {
          "code":"EPSG:32632",
          "proj":"+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs",
          "label":"WGS 84 / UTM zone 32N"
        },
        {
          "code":"EPSG:31254",
          "proj":"+proj=tmerc +lat_0=0 +lon_0=10.33333333333333 +k=1 +x_0=0 +y_0=-5000000 +ellps=bessel +towgs84=577.326,90.129,463.919,5.137,1.474,5.297,2.4232 +units=m +no_defs +axis=neu",
          "label":"MGI / Austria GK West"
        },
        {
          "code":"EPSG:21781",
          "proj":"+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.4,15.1,405.3,0,0,0,0 +units=m +no_defs",
          "label":"CH1903 / LV03"
        },
        {
          "code":"EPSG:2056",
          "proj":"+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs",
          "label":"CH1903+ / LV95"
        },
        {
          "code":"EPSG:25832",
          "proj":"+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",
          "label":"ETRS89 / UTM 32N"
        },
        {
          "code":"EPSG:31983",
          "proj":"+proj=utm +zone=23 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",
          "label":"SIRGAS 2000 / UTM zone 23S"
        }
      ],
      "plugins":{
        "common": [
          {
            "name":"API"
          },
          {
            "name":"AttributeTable"
          },
          {
            "name":"Authentication"
          },
          {
            "name":"BackgroundSwitcher",
            "cfg":{
              "position":0
            }
          },
          {
            "name":"Bookmark"
          },
          {
            "name":"BottomBar",
            "cfg":{
              "viewertitleUrl":"https://qwc-services.github.io/",
              "termsUrl":"https://github.com/qwc-services/qwc-docker/blob/master/LICENSE/"
            }
          },
          {
            "name":"Editing",
            "cfg":{
              "snapping":true,
              "snappingActive":true
            }
          },
          {
            "name":"FeatureForm"
          },
          {
            "name":"Help",
            "cfg": {
              "bodyContentsFragmentUrl": "assets/help.html"
            },
            "mapClickAction":"identify"
          },
          {
            "name":"Identify",
            "cfg":{
              "params":{
                "FI_POINT_TOLERANCE":16,
                "FI_LINE_TOLERANCE":8,
                "FI_POLYGON_TOLERANCE":4,
                "feature_count":20,
                "region_feature_count":100
              },
              "enableExport":true,
              "longAttributesDisplay":"wrap",
              "displayResultTree":false,
              "featureInfoReturnsLayerName":false,
              "initialWidth":480,
              "initialHeight":550
            }
          },
          {
            "name":"HeightProfile",
            "cfg":{
              "heighProfilePrecision":0
            }
          },
          {
            "name":"LayerCatalog",
            "cfg":{
              "catalogUrl":"assets/catalog.json"
            }
          },
          {
            "name":"LayerTree",
            "cfg":{
              "showLegendIcons":true,
              "showRootEntry":true,
              "showQueryableIcon":true,
              "allowMapTips":true,
              "allowCompare":true,
              "allowImport":true,
              "groupTogglesSublayers":false,
              "grayUnchecked":false,
              "layerInfoWindowSize":{
                "width":480,
                "height":400
              },
              "bboxDependentLegend":"theme",
              "scaleDependentLegend":"theme",
              "showToggleAllLayersCheckbox":true
            },
            "mapClickAction":"identify"
          },
          {
            "name":"Map",
            "cfg":{
              "mapOptions":{
                "zoomDuration":250,
                "enableRotation":true
              },
              "toolsOptions":{
                "OverviewSupport":{
                  "tipLabel":"Overview"
                },
                "LocateSupport":{
                  "keepCurrentZoomLevel":true,
                  "stopFollowingOnDrag":true,
                  "startupMode":"DISABLED"
                },
                "ScaleBarSupport":{
                  "units":"metric"
                }
              },
              "swipeGeometryTypeBlacklist":[
              ],
              "swipeLayerNameBlacklist":[
              ]
            }
          },
          {
            "name":"MapCompare"
          },
          {
            "name":"MapCopyright"
          },
          {
            "name":"MapExport"
          },
          {
            "name":"MapFilter",
            "cfg": {
              "allowCustomFilters": true,
              "allowFilterByGeom": true,
              "allowFilterByTime": true,
              "position": 6
            }
          },
          {
            "name":"MapInfoTooltip",
            "cfg":{
              "elevationPrecision":0,
              "includeWGS84":true
            }
          },
          {
            "name":"MapLegend",
            "cfg":{
              "bboxDependentLegend":"theme",
              "scaleDependentLegend":"theme"
            }
          },
          {
            "name":"Measure",
            "cfg":{
              "showMeasureModeSwitcher":true,
              "snapping":true,
              "snappingActive":true
            }
          },
          {
            "name": "NewsPopup",
            "cfg": {
              "newsDocument": "https://qwc-services.github.io/master/release_notes/ChangeLog/",
              "newsRev": "20250210"
            }
          },
          {
            "name":"Print",
            "cfg":{
              "inlinePrintOutput":true,
              "printExternalLayers":true,
              "gridInitiallyEnabled":false
            }
          },
          {
            "name":"Redlining",
            "cfg":{
              "snapping":true,
              "snappingActive":true
            }
          },
          {
            "name":"Routing"
          },
          {
            "name":"Settings",
            "cfg":{
              "languages":[
                {
                  "title":"English",
                  "value":"en-US"
                },
                {
                  "title":"Deutsch",
                  "value":"de-CH"
                },
                {
                  "title":"Fran√ßais",
                  "value":"fr-FR"
                },
                {
                  "title":"Italiano",
                  "value":"it-IT"
                }
              ],
              "colorSchemes":[
                {
                  "titleMsgId":"colorschemes.default",
                  "value":"default"
                },
                {
                  "titleMsgId":"colorschemes.highcontrast",
                  "value":"highcontrast"
                },
                {
                  "titleMsgId":"colorschemes.dark",
                  "value":"dark"
                }
              ]
            }
          },
          {
            "name":"ScratchDrawing"
          },
          {
            "name":"Share",
            "cfg":{
              "showSocials":true,
              "showLink":true,
              "showQRCode":true
            },
            "mapClickAction":"identify"
          },
          {
            "name":"StartupMarker",
            "cfg":{
              "removeMode":"onclickonmarker"
            }
          },
          {
            "name":"ThemeSwitcher",
            "cfg":{
              "collapsibleGroups":true
            }
          },
          {
            "name":"TimeManager",
            "cfg":{
              "defaultTimelineDisplay":"features"
            },
            "mapClickAction":"identify"
          },
          {
            "name":"TopBar",
            "cfg":{
              "menuItems":[
                {
                  "key":"ThemeSwitcher",
                  "icon":"themes"
                },
                {
                  "key":"LayerTree",
                  "icon":"layers"
                },
                {
                  "key": "MapLegend",
                  "icon": "list-alt"
                },
                {
                  "key":"LayerCatalog",
                  "icon":"catalog"
                },
                {
                  "key":"Share",
                  "icon":"share"
                },
                {
                  "key":"Bookmark",
                  "icon":"bookmark"
                },
                {
                  "key":"Tools",
                  "icon":"tools",
                  "subitems":[
                    {
                      "key":"Identify",
                      "icon":"identify_region",
                      "mode":"Region"
                    },
                    {
                      "key":"Measure",
                      "icon":"measure"
                    },
                    {
                      "key":"Redlining",
                      "icon":"draw"
                    },
                    {
                      "key": "MapFilter",
                      "icon": "filter"
                    },
                    {
                      "key":"Editing",
                      "icon":"editing"
                    },
                    {
                      "key":"FeatureForm",
                      "icon":"featureform"
                    },
                    {
                      "key":"AttributeTable",
                      "icon":"editing"
                    },
                    {
                      "key":"MapExport",
                      "icon":"rasterexport"
                    },
                    {
                      "key":"TimeManager",
                      "icon":"clock"
                    },
                    {
                      "key":"Routing",
                      "icon":"routing"
                    }
                  ]
                },
                {
                  "key":"Print",
                  "icon":"print"
                },
                {
                  "key":"Help",
                  "icon":"info"
                },
                {
                  "key":"Settings",
                  "icon":"cog"
                },
                {
                  "key":"Login",
                  "icon":"login"
                }
              ],
              "searchOptions":{
                "minScaleDenom":1000,
                "showProviderSelection":true,
                "providerSelectionAllowAll":true,
                "zoomToLayers":false,
                "showProvidersInPlaceholder":false
              },
              "appMenuClearsTask":true,
              "appMenuFilterField":true,
              "appMenuVisibleOnStartup":false,
              "logoUrl":"/"
            }
          }
        ],
        "mobile":[
          {
            "name":"BottomBar",
            "cfg":{
              "displayCoordinates":false,
              "displayScales":false
            }
          },
          {
            "name":"HomeButton",
            "cfg":{
              "position":2
            }
          },
          {
            "name":"LocateButton",
            "cfg":{
              "position":1
            }
          }
        ],
        "desktop":[
          {
            "name":"HomeButton",
            "cfg":{
              "position":4
            }
          },
          {
            "name":"LocateButton",
            "cfg":{
              "position":3
            }
          },
          {
            "name":"MapTip"
          },
          {
            "name":"TaskButton",
            "cfg":{
              "position":5,
              "task":"LayerTree",
              "icon":"list-alt"
            }
          },
          {
            "name":"TopBar",
            "cfg":{
              "toolbarItems":[
                {
                  "key":"Measure",
                  "mode":"LineString",
                  "icon":"measure_line"
                },
                {
                  "key":"Measure",
                  "mode":"Polygon",
                  "icon":"measure_polygon"
                },
                {
                  "key":"Print",
                  "icon":"print"
                },
                {
                  "key":"Identify",
                  "icon":"identify_region",
                  "mode":"Region"
                }
              ]
            }
          },
          {
            "name":"ZoomIn",
            "cfg":{
              "position":2
            }
          },
          {
            "name":"ZoomOut",
            "cfg":{
              "position":1
            }
          }
        ]
      }
    }
  index.html: |
    <!-- Build version  <%= htmlWebpackPlugin.options.build %> -->
    <!DOCTYPE html>
    <html>
        <head>
            <meta charset="UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" />
            <meta name="HandheldFriendly" content="true" />
            <meta name="mobile-web-app-capable" content="yes" />
            <title>QGIS Web Client 2</title>
            <link rel="stylesheet" type="text/css" href="assets/css/qwc2.css" />
            <link rel="stylesheet" type="text/css" href="assets/css/colorschemes.css" />
            <link rel="apple-touch-icon" href="assets/img/app_icon.png"/>
            <link rel="apple-touch-icon" sizes="72x72" href="assets/img/app_icon_72.png"/>
            <link rel="apple-touch-icon" sizes="114x114" href="assets/img/app_icon_114.png"/>
            <link rel="apple-touch-icon" sizes="144x144" href="assets/img/app_icon_144.png"/>
            <link rel="icon" href="assets/img/favicon.ico" />
            <style type="text/css">
            div#splash {
                position: fixed;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .lds-dual-ring {
                display: inline-block;
                width: 80px;
                height: 80px;
            }
            .lds-dual-ring:after {
                content: " ";
                display: block;
                width: 64px;
                height: 64px;
                margin: 8px;
                border-radius: 50%;
                border: 6px solid #595959;
                border-color: #595959 transparent #595959 transparent;
                animation: lds-dual-ring 1.2s linear infinite;
            }
            @keyframes lds-dual-ring {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }
            </style>
            <!--<script type="text/javascript" src="assets/searchProviders.js" ></script>-->
            <script type="text/javascript">
            window.addEventListener("load", function(ev) {
                document.getElementById('splash').style.display = 'none';
            }, false);
            </script>
        </head>
        <body>
            <div id="splash"><div class="lds-dual-ring"></div></div>
            <div id="container"></div>
            <script src="dist/QWC2App.js"></script>
        </body>

    </html>
  tenantConfig.json: |
    {
      "$schema": "https://github.com/qwc-services/qwc-config-generator/raw/master/schemas/qwc-config-generator.json",
      "service": "config-generator",
      "config": {
        "autogen_keyvaltable_datasets": true,
        "config_db_url": "postgresql:///?service=qwc_configdb",
        "default_qgis_server_url": "http://qwc-qgis-server/ows/",
        "generate_nested_nrel_forms": false,
        "generate_wfs_services": false,
        "permissions_default_allow": true,
        "qgis_projects_base_dir": "/data",
        "qgis_projects_scan_base_dir": "/data/scan",
        "strip_scan_prefix_from_theme_names": true,
        "tenant": "default",
        "validate_schema": true,
        "use_default_map_thumbnail": true
      },
      "themesConfig": "./themesConfig.json",
      "services": [
        {
          "name": "adminGui",
          "config": {
            "config_generator_service_url": "http://qwc-config-service:9090",
            "db_url": "postgresql:///?service=qwc_configdb",
            "input_config_path": "/srv/qwc_service/config-in",
            "info_templates_path": "/info_templates",
            "default_qgis_server_url": "http://qwc-qgis-server/ows/",
            "ows_prefix": "/ows",
            "ows_service_url": "/ows",
            "plugins": [],
            "qgs_resources_path": "/qgs-resources",
            "qwc2_path": "/qwc2",
            "solr_service_url": "http://qwc-solr:8983/solr/gdi/select",
            "solr_tenant_dih": "dih_geodata_config",
            "totp_enabled": false,
            "user_info_fields": []
          }
        },
        {
          "name": "data",
          "config": {
            "geometry_default_allow_null": false
          }
        },
        {
          "name": "document",
          "config": {
          }
        },
        {
          "name": "dbAuth",
          "config": {
            "db_url": "postgresql:///?service=qwc_configdb"
          }
        },
        {
          "name": "elevation",
          "config": {
            "elevation_dataset": "/vsicurl/https://data.sourcepole.com/srtm_1km_3857.tif"
          }
        },
        {
          "name": "featureInfo",
          "config": {
            "data_service_url": "/api/v1/data/",
            "skip_empty_attributes": false
          }
        },
        {
          "name": "legend",
          "config": {
            "legend_images_path": "/legends/"
          }
        },
        {
          "name": "mapinfo",
            "config": {
            "queries": [
              {
                "db_url": "postgresql:///?service=qwc_geodb",
                "info_display_col": "name",
                "info_geom_col": "wkb_geometry",
                "info_table": "qwc_geodb.ne_10m_admin_0_countries",
                "info_title": "Country"
              },
              {
                "db_url": "postgresql:///?service=qwc_geodb",
                "info_sql": "SELECT type FROM qwc_geodb.ne_10m_admin_0_countries WHERE ST_contains(wkb_geometry, ST_SetSRID(ST_Point(:x, :y), :srid)) LIMIT 1",
                "info_title": "Type"
              }
            ]
          }
        },
        {
          "name": "mapViewer",
          "generator_config": {
            "qwc2_config": {
              "qwc2_config_file": "/srv/qwc_service/config-in/default/config.json",
              "qwc2_index_file": "/srv/qwc_service/config-in/default/index.html"
            }
          },
          "config": {
            "qwc2_path": "/qwc2/",
            "auth_service_url": "/auth/",
            "data_service_url": "/api/v1/data/",
            "document_service_url": "/api/v1/document/",
            "elevation_service_url": "/api/v1/elevation/",
            "info_service_url": "/api/v1/featureinfo/",
            "legend_service_url": "/api/v1/legend/",
            "mapinfo_service_url": "/api/v1/mapinfo/",
            "ogc_service_url": "/ows/",
            "permalink_service_url": "/api/v1/permalink/",
            "print_service_url": "/api/v1/print/",
            "search_service_url": "/api/v2/search/",
            "search_data_service_url": "/api/v2/search/geom/"
          }
        },
        {
          "name": "ogc",
          "config": {
          },
          "generator_config": {
            "wms_services": {
              "online_resources": {
                "feature_info": "/api/v1/featureinfo/",
                "legend": "/api/v1/legend/",
                "service": "/ows/"
              }
            }
          }
        },
        {
          "name": "permalink",
          "config": {
            "db_url": "postgresql:///?service=qwc_configdb",
            "permalinks_table": "qwc_config.permalinks",
            "user_permalink_table": "qwc_config.user_permalinks",
            "user_bookmark_table": "qwc_config.user_bookmarks"
          }
        },
        {
          "name": "print",
          "config": {
            "ogc_service_url": "http://qwc-ogc-service:9090/"
          }
        },
        {
          "name": "search",
          "config": {
            "db_url": "postgresql:///?service=qwc_geodb",
            "search_backend": "solr",
            "search_result_limit": 50,
            "solr_service_url": "http://qwc-solr:8983/solr/gdi/select"
          },
          "resources": {
            "facets": [
              {
                "name": "ne_10m_admin_0_countries",
                "filter_word": "Country",
                "table_name": "qwc_geodb.ne_10m_admin_0_countries",
                "geometry_column": "wkb_geometry",
                "search_id_col": "ogc_fid"
              }
            ]
          }
        }
      ]
    }
  themesConfig.json: |
    {
        "defaultScales": [100000000, 50000000, 25000000, 10000000, 4000000, 2000000, 1000000, 400000, 200000, 80000, 40000, 20000, 10000, 8000, 6000, 4000, 2000, 1000, 500, 250, 100],
        "defaultPrintGrid": [
            {"s": 10000000, "x": 1000000, "y": 1000000},
            {"s": 1000000, "x": 100000, "y": 100000},
            {"s": 100000, "x": 10000, "y": 10000},
            {"s": 10000, "x": 1000, "y": 1000},
            {"s": 1000, "x": 100, "y": 100},
            {"s": 100, "x": 10, "y": 10}
        ],
        "defaultWMSVersion": "1.3.0",
        "defaultBackgroundLayers": [],
        "defaultSearchProviders": ["coordinates"],
        "defaultMapCrs": "EPSG:3857",
        "defaultTheme": "qwc_demo",
        "themes": {
            "items": [
                {
                    "id": "qwc_demo",
                    "title": "QWC Demo Theme",
                    "url": "/ows/qwc_demo",
                    "attribution": "Demo attribution",
                    "attributionUrl": "https://example.com/",
                    "backgroundLayers": [
                        {"name": "bluemarble", "printLayer": "bluemarble_bg", "visibility": true},
                        {"name": "mapnik", "printLayer": "osm_bg"}
                    ],
                    "searchProviders": [
                        "coordinates",
                        "nominatim",
                        {
                            "provider": "fulltext",
                            "params": {
                                "default": ["ne_10m_admin_0_countries"]
                            }
                        }
                    ],
                    "mapCrs": "EPSG:3857",
                    "additionalMouseCrs": [],
                    "extent": [-1000000,4000000,3000000,8000000],
                    "printResolutions": [100, 300],
                    "thumbnail": "qwc_demo.jpg",
                    "featureReport": {
                        "countries": "Country"
                    },
                    "predefinedFilters": [{
                        "id": "continent_filter",
                        "title": "Continent",
                        "filter": {
                            "countries": ["continent", "=", "$continent$"]
                        },
                        "fields": [{
                            "id": "continent",
                            "title": "Name",
                            "defaultValue": "",
                            "inputConfig": {"type": "select", "options": ["Africa", "Asia", "Europe", "Oceania"]}
                        }]
                    }],
                    "extraLegendParameters": "LAYERTITLE=FALSE",
                    "defaultPrintLayout": "A4 Landscape"
                }
            ],
            "backgroundLayers": [
                {
                    "name": "mapnik",
                    "title": "Open Street Map",
                    "type": "osm",
                    "source": "osm",
                    "attribution": "OpenStreetMap contributors",
                    "attributionUrl": "https://www.openstreetmap.org/copyright",
                    "thumbnail": "img/mapthumbs/mapnik.jpg"
                },
                {
                    "type": "wmts",
                    "url": "http://gibs.earthdata.nasa.gov/wmts/epsg3857/best/BlueMarble_ShadedRelief/default/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}.jpeg",
                    "title": "Blue Marble",
                    "name": "bluemarble",
                    "tileMatrixPrefix": "",
                    "tileMatrixSet": "GoogleMapsCompatible_Level8",
                    "originX": -20037508.34278925,
                    "originY": 20037508.34278925,
                    "projection:": "EPSG:3857",
                    "resolutions": [156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781],
                    "tileSize": [256,256],
                    "thumbnail": "img/mapthumbs/bluemarble.jpg"
                }
            ]
        }
    }
kind: ConfigMap
metadata:
  labels:
    io.kompose.service: qwc-config-service
  name: qwc-config-service-cm0
